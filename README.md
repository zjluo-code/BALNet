BALNet: Deep Learning-Based Detection and Measurement of Broad Absorption Lines in Quasar Spectra

1) Model Overview
This repository provides the implementation of BALNet, a deep learning framework designed to detect and measure Broad Absorption Line (BAL) troughs in quasar spectra. BALNet integrates a one-dimensional convolutional neural network (1D-CNN) with bidirectional long short-term memory (Bi-LSTM) networks to achieve high accuracy and efficiency in identifying BAL quasars and characterizing their absorption features.

2) Data Preparation
Before executing the code, please prepare the data as follows:
i) Download the training and testing data：
* Link: https://drive.google.com/drive/folders/1-tKdAEW17ybIda3YyMjlY_fJsZi264PN?usp=sharing
* Files: M_SPEC.fits and Mcata.fits.
* Description: These files contain simulated spectra and corresponding labels for 100,000 BAL quasars and 100,000 non-BAL quasars (in random order). The simulations are generated by merging non-BAL quasar spectra from SDSS DR16 with synthetic BAL troughs. The detailed procedure is implemented in MockData.py. This dataset serves as the model's training and testing set.
ii) Download SDSS DR16Q Catalog and Spectra:
* Files: The SDSS DR16 quasar catalog (DR16Q_v4.fits) and its corresponding spectra.
* Description: We have pre-processed the spectra (within a redshift range of 1.5 to 5.7 and a rest-frame wavelength range of 1300–1700 Å) into a single file named Flux_DR16Q.fits. This file is also available at the link provided in step (i).
iii) Convert to HDF5 Format:
* Scripts: Use mkh5_BAL.py and dr16q_mkh5_BAL.py to convert the files from steps (i) and (ii) into HDF5 format for direct model input.
* Output: The conversion generates BAL_spec.h5 (from the simulated data) and dr16Q_BAL_spec.h5 (from the SDSS data). These HDF5 files are also provided in the link from step (i) for direct download.

3) Model Training 
To train the model, run the following command:
python BALNet.py
* Configuration: The model is trained using the Adam optimizer (learning rate = 0.0001) with a batch size of 256.
* Hardware: Training runs for 200 epochs on an NVIDIA RTX 3090 GPU.
* Output: The trained model is saved as BAL_iden_200.h5 in the current directory.

4) Application
The trained BALNet model can be applied to large-scale quasar spectral datasets to identify BAL quasars and measure their troughs. When applied to the SDSS DR16Q dataset, BALNet detected BAL troughs in 20.4% of the spectra, which includes 8.8% redshifted systems and many newly identified sources. The full prediction catalog is available in DR16Q_pred.zip.
To run the prediction on new data, use:
python BALNet_pred.py
